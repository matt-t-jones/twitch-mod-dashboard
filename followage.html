<!doctype html>
<html lang="en">
<head>
<title>Followage Tool</title>
<link rel="shortcut icon" href="https://mattunderscore.co/favicon.ico?ver=12">
<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
<script   src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<base target="_blank" />
<style type="text/css">
html, body {
	color: white;
	background-color: rgb(40, 40, 40) !important;
}
input {
	color: black !important;
}
.nodrag {
	user-drag: none;
	-moz-user-select: none;
	-webkit-user-drag: none;
}
p {
	font-size: 12px;
	text-align: center;
}
</style>
<script type="text/javascript">
			function getFollowage(){
			document.getElementById('result').innerHTML = "<img src='loading-bar.gif' class='nodrag' />";
			var username = document.getElementById('username').value;
			var channelName = document.getElementById('channelName').value;

			document.getElementById('result').textContent = "";
			document.getElementById('prefix').textContent = "";


			$.ajax({
			url: "https://cors-anywhere.herokuapp.com/https://2g.be/twitch/following.php?user=" + username + "&channel=" + channelName + "&format=ymwd",
			success: function (data) {

			var displayUsername;
			var displayChannelName;
			var userLogo;
			var channelLogo;

			$.ajax({
			 type: 'GET',
			 url: 'https://api.twitch.tv/kraken/channels/' + username,
			 headers: {
			   'Client-ID': 'ml1jq1dzn8ryxrt595ep8hpn8dnpez6'
			 },
			 success: function(data) {
			   console.log(data);
					displayUsername = data.display_name;
					if (data.logo == null) {
					userLogo = "https://static-cdn.jtvnw.net/jtv_user_pictures/xarth/404_user_70x70.png"
					}
					else{
					userLogo = data.logo;
					}
					 }
				 });

			$.ajax({
			 type: 'GET',
			 url: 'https://api.twitch.tv/kraken/channels/' + channelName,
			 headers: {
			   'Client-ID': 'ml1jq1dzn8ryxrt595ep8hpn8dnpez6'
			 },
			 success: function(data) {
			   console.log(data);
					displayChannelName = data.display_name;
					if (data.logo == null) {
					channelLogo = "https://static-cdn.jtvnw.net/jtv_user_pictures/xarth/404_user_70x70.png"
					}
					else{
					channelLogo = data.logo;
					}

					 }
					});

			var doNotDisplay = 0;

			if (username != "" && channelName != "") {
			setTimeout(function() {
			if (displayUsername != undefined && displayChannelName != undefined) {
			document.getElementById('result').innerHTML = "<img src='loading-bar.gif' class='nodrag' />";
			document.getElementById('username').value = displayUsername;
			document.getElementById('channelName').value = displayChannelName;
			document.getElementById('prefix').innerHTML =
			"<a href='https://www.twitch.tv/" + displayUsername + "' target='_blank'><img src='" + userLogo + "' height='30' width='30' class='nodrag' title='" + displayUsername + "' /></a> has been following <a href='https://www.twitch.tv/" + displayChannelName + "' target='_blank'><img src='" + channelLogo + "' height='30' width='30' class='nodrag' title='" + displayChannelName + "' /></a> for";
			}
			else {runError(); doNotDisplay = 1;}
			}, 500);




			setTimeout(function() {
			if (doNotDisplay == 0 && displayUsername != undefined && displayChannelName != undefined) {
				if (!data.includes("is not following")) {
					document.getElementById('result').textContent = data.split("for")[1];
				}
				else document.getElementById('result').textContent = data;
			}
			}, 2000);

			}

			else {
			document.getElementById('prefix').textContent = "";
			document.getElementById('result').innerHTML = "<img src='loading-bar.gif' class='nodrag' />";

			setTimeout(function() {
			document.getElementById('result').textContent = "(error)";
			}, 2000);

			}

			},
			dataType: "html",
			error: function (data) {
			document.getElementById('prefix').textContent = "";
			document.getElementById('result').innerHTML = "<img src='loading-bar.gif' class='nodrag' />";

			setTimeout(function() {
			document.getElementById('result').textContent = "(error)";
			}, 2000);}
			});
			}

			function runError()	{
			document.getElementById('prefix').textContent = "";
			document.getElementById('result').innerHTML = "<img src='loading-bar.gif' class='nodrag' />";

			setTimeout( function(){
			document.getElementById('result').textContent = "(error)";
			}, 2000)
			}


			function swapNames()
			{
				var name1 = document.getElementById('username').value;
				var name2 = document.getElementById('channelName').value;

				document.getElementById('username').value = name2;
				document.getElementById('channelName').value = name1;
			}


			function getAttr() {

			function getAllUrlParams(url) {

			  // get query string from url (optional) or window
			  var queryString = url ? url.split('?')[1] : window.location.search.slice(1);

			  // we'll store the parameters here
			  var obj = {};

			  // if query string exists
			  if (queryString) {

				// stuff after # is not part of query string, so get rid of it
				queryString = queryString.split('#')[0];

				// split our query string into its component parts
				var arr = queryString.split('&');

				for (var i=0; i<arr.length; i++) {
				  // separate the keys and the values
				  var a = arr[i].split('=');

				  // in case params look like: list[]=thing1&list[]=thing2
				  var paramNum = undefined;
				  var paramName = a[0].replace(/\[\d*\]/, function(v) {
					paramNum = v.slice(1,-1);
					return '';
				  });

				  // set parameter value (use 'true' if empty)
				  var paramValue = typeof(a[1])==='undefined' ? true : a[1];

				  // (optional) keep case consistent
				  paramName = paramName.toLowerCase();
				  paramValue = paramValue.toLowerCase();

				  // if parameter name already exists
				  if (obj[paramName]) {
					// convert value to array (if still string)
					if (typeof obj[paramName] === 'string') {
					  obj[paramName] = [obj[paramName]];
					}
					// if no array index number specified...
					if (typeof paramNum === 'undefined') {
					  // put the value on the end of the array
					  obj[paramName].push(paramValue);
					}
					// if array index number specified...
					else {
					  // put the value at that index number
					  obj[paramName][paramNum] = paramValue;
					}
				  }
				  // if param name doesn't exist yet, set it
				  else {
					obj[paramName] = paramValue;
				  }
				}
			  }

			  return obj;
			}

			setTimeout ( function () {
			var user = getAllUrlParams().u;
			var chan = getAllUrlParams().c;

			if (user) {
			document.getElementById('username').value = user;
			}

			if (chan) {
			document.getElementById('channelName').value = chan;
			}

			if (chan && user) {
			getFollowage();
			}

			}, 0);
			}
			getAttr();
			</script>
</head>
<body style="text-align: center; zoom:150%;">
<h3>Followage Tool</h3>
<div style="padding-bottom: 15px;">
<cite>APIs provided by <a href="https://2g.be">2g.be</a> and Twitch</cite>
</div>
<input id="username" placeholder="twitch username" tabindex="1" autofocus>
<br />
<a href="#" onclick="swapNames(); return false;"><img src="swap.png?revision=12-22-2017-0" width="35" height="35" class="nodrag" style="margin-top:10px; margin-bottom:10px;" title="swap names" tabindex="-1" /></a>
<br />
<input id="channelName" placeholder="name of channel" tabindex="2">
<br />
<br />
<div style="text-align: center;">
<button type="button" class="btn btn-success" onclick="getFollowage()" tabindex="3">check followage</button>
</div>
<br />
<br />
<h5 id="prefix"></h5>
<h1 id="result"></h1>
</body>
</html>
